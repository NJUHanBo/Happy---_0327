# 手动测试清单

**在每次重构后运行这个测试，确保功能正常。**

---

## 测试前准备

### 1. 备份当前数据

打开浏览器控制台（F12），执行：

```javascript
// 备份当前数据
const currentData = localStorage.getItem('matchstickTimeManager');
if (currentData) {
    const backupKey = 'matchstickTimeManager_backup_' + new Date().toISOString().replace(/[:.]/g, '-');
    localStorage.setItem(backupKey, currentData);
    console.log('✅ 备份已创建:', backupKey);
} else {
    console.log('ℹ️ 没有数据需要备份');
}
```

### 2. 查看所有备份

```javascript
// 列出所有备份
Object.keys(localStorage)
    .filter(k => k.includes('backup'))
    .forEach(k => console.log('📦', k));
```

---

## 核心功能测试

### ✅ 测试1：应用启动

1. 启动服务器：`python server.py`
2. 打开浏览器：http://localhost:8000
3. 打开控制台（F12）

**预期结果：**
- [ ] 页面正常加载
- [ ] 控制台显示 `[Refactoring]` 开头的日志
- [ ] 控制台显示 `StorageManager available: true`
- [ ] 控制台显示 `StateManager available: true`
- [ ] 如果有保存的数据，显示主界面
- [ ] 如果是首次使用，显示初始化界面

**实际结果：**
```
_____________________
```

---

### ✅ 测试2：数据加载（针对已有用户）

如果你有保存的角色和数据：

**检查项：**
- [ ] 角色名字正确显示
- [ ] 头像正确显示
- [ ] 火柴神图片正确显示
- [ ] 统计数据正确（体力、精力、木屑、火苗、灰烬）
- [ ] 天数统计正确（总天数、燃烧天数）
- [ ] 黑狗状态显示正确
- [ ] 日常任务列表正确
- [ ] 项目列表正确
- [ ] 待办事项列表正确

**控制台检查：**
```javascript
// 查看加载的数据版本
const state = JSON.parse(localStorage.getItem('matchstickTimeManager'));
console.log('📊 数据版本:', state.version);
console.log('💾 最后保存时间:', state.lastSaved);
console.log('🔥 火苗数量:', state.stats.flame);
console.log('📅 总天数:', state.stats.totalDays);
```

**实际结果：**
```
_____________________
```

---

### ✅ 测试3：创建新角色（针对新用户）

如果是首次使用：

**步骤：**
1. 进入角色创建界面
2. 选择性别
3. 输入名字
4. 选择火柴神类型
5. 上传头像（可选）
6. 点击"开始燃烧"

**预期结果：**
- [ ] 能成功创建角色
- [ ] 进入主界面
- [ ] 角色信息正确显示
- [ ] 初始资源正确（体力100、精力50、木屑100、火苗100、灰烬10000）

**实际结果：**
```
_____________________
```

---

### ✅ 测试4：添加任务

#### 4.1 添加日常任务

1. 点击"添加日常"
2. 输入任务信息
3. 保存

**检查项：**
- [ ] 对话框正常打开
- [ ] 能输入任务名称
- [ ] 能设置时长
- [ ] 能设置重要性和兴趣度
- [ ] 能成功保存
- [ ] 任务出现在"星星之火"板块

#### 4.2 添加项目

1. 点击"添加项目"
2. 输入项目信息
3. 添加里程碑
4. 保存

**检查项：**
- [ ] 能成功创建项目
- [ ] 项目出现在"筑梦建筑师"板块
- [ ] 里程碑正确显示

#### 4.3 添加待办

1. 点击"添加待办"
2. 输入待办信息
3. 保存

**检查项：**
- [ ] 能成功创建待办
- [ ] 待办出现在"蜡炬成灰"板块

**实际结果：**
```
_____________________
```

---

### ✅ 测试5：完成任务

#### 5.1 完成日常任务

1. 进入"星星之火"
2. 点击一个任务开始计时
3. 结束任务
4. 评分

**检查项：**
- [ ] 计时器正常工作
- [ ] 能暂停/继续
- [ ] 能结束任务
- [ ] 能评分（1-5星）
- [ ] 获得木屑奖励
- [ ] 消耗体力和精力
- [ ] 数据正确保存

#### 5.2 完成待办事项

1. 进入"蜡炬成灰"
2. 完成一个待办
3. 评分

**检查项：**
- [ ] 能完成待办
- [ ] 获得火苗奖励
- [ ] 数据正确保存

#### 5.3 完成项目里程碑

1. 进入"筑梦建筑师"
2. 点击项目继续任务
3. 完成里程碑

**检查项：**
- [ ] 能完成里程碑
- [ ] 进度条更新
- [ ] 获得奖励
- [ ] 数据正确保存

**实际结果：**
```
_____________________
```

---

### ✅ 测试6：数据保存和恢复

#### 6.1 手动保存

在控制台执行：
```javascript
saveState();
console.log('✅ 手动保存完成');
```

**检查项：**
- [ ] 控制台显示 `[Refactoring] Using StorageManager.saveState`
- [ ] 控制台显示 `[Storage] State saved (version 1)`
- [ ] 没有错误

#### 6.2 刷新页面恢复

1. 刷新浏览器（F5）
2. 检查数据是否正确恢复

**检查项：**
- [ ] 所有数据正确恢复
- [ ] 控制台显示 `[Refactoring] State loaded successfully from StorageManager`
- [ ] 控制台显示 `[Storage] Loaded state (version 1)`

#### 6.3 模拟数据迁移

在控制台执行：
```javascript
// 模拟版本0的旧数据
const oldData = JSON.parse(localStorage.getItem('matchstickTimeManager'));
delete oldData.version; // 移除版本号，模拟旧版本
localStorage.setItem('matchstickTimeManager', JSON.stringify(oldData));
console.log('✅ 已创建版本0数据');

// 刷新页面
location.reload();
```

**预期结果：**
- [ ] 控制台显示 `[Storage] Migrating from v0 to v1`
- [ ] 控制台显示 `[Storage] Migration completed`
- [ ] 数据正确加载
- [ ] 数据版本变为1

**实际结果：**
```
_____________________
```

---

### ✅ 测试7：结束一天

1. 点击"结束一天"
2. 查看预览
3. 确认

**检查项：**
- [ ] 预览正确显示当天统计
- [ ] 火苗减半（如果没有助燃剂）
- [ ] 体力精力重置
- [ ] 进入夜晚过渡页面
- [ ] 显示鼓励语
- [ ] 能开始新的一天
- [ ] 天数+1
- [ ] 数据正确保存

**实际结果：**
```
_____________________
```

---

### ✅ 测试8：商店系统

1. 点击"愿望商店"
2. 购买商品
3. 检查效果

**检查项：**
- [ ] 商店界面正常打开
- [ ] 显示当前灰烬数量
- [ ] 能购买商品
- [ ] 灰烬正确扣除
- [ ] 商品效果正确应用
- [ ] 数据正确保存

**实际结果：**
```
_____________________
```

---

### ✅ 测试9：其他功能

#### 9.1 杂念垃圾桶

- [ ] 能打开
- [ ] 能写入内容
- [ ] 能保存
- [ ] 15分钟计时器工作正常

#### 9.2 草稿纸

- [ ] 能打开
- [ ] 能创建草稿
- [ ] 能查看草稿
- [ ] 能删除草稿

#### 9.3 查看日志

- [ ] 能打开
- [ ] 显示历史记录
- [ ] 按日期分组

#### 9.4 任务统计

- [ ] 能打开
- [ ] 显示统计数据
- [ ] 数据正确

#### 9.5 数据备份

- [ ] 能导出数据
- [ ] 能导入数据
- [ ] 导入后数据正确

#### 9.6 设置

- [ ] 能打开设置
- [ ] 能修改设置
- [ ] 设置正确保存

**实际结果：**
```
_____________________
```

---

## 性能测试

### 检查localStorage大小

在控制台执行：

```javascript
// 查看localStorage使用情况
let total = 0;
for (let key in localStorage) {
    if (localStorage.hasOwnProperty(key)) {
        const size = localStorage[key].length;
        total += size;
        if (key.includes('matchstick')) {
            console.log(`📦 ${key}: ${(size / 1024).toFixed(2)} KB`);
        }
    }
}
console.log(`💾 总计: ${(total / 1024).toFixed(2)} KB / ${(5 * 1024).toFixed(0)} KB`);
```

**预期：**
- [ ] 主数据 < 1MB
- [ ] 总计 < 5MB（localStorage限制）

---

## 兼容性测试

### 测试浏览器

- [ ] Chrome/Edge
- [ ] Firefox
- [ ] Safari

### 测试场景

- [ ] 新用户首次使用
- [ ] 老用户数据迁移
- [ ] 大量数据（100+任务）
- [ ] 长时间使用（30天+）

---

## 回归测试（在重构后必做）

**每次重构后，至少完成以下测试：**

1. [ ] 测试1：应用启动
2. [ ] 测试2：数据加载
3. [ ] 测试4：添加任务（任意一种）
4. [ ] 测试5：完成任务（任意一种）
5. [ ] 测试6.1：手动保存
6. [ ] 测试6.2：刷新页面恢复

**如果以上全部通过，重构是安全的。**

---

## 问题报告模板

如果发现问题，记录以下信息：

```
### 问题描述
简述问题

### 复现步骤
1. 
2. 
3. 

### 预期结果
应该发生什么

### 实际结果
实际发生了什么

### 控制台错误
粘贴控制台错误信息

### 环境信息
- 浏览器：
- 操作系统：
- 是否是重构后首次运行：
- 之前有无保存的数据：

### LocalStorage数据
执行以下代码并粘贴结果：
console.log(JSON.parse(localStorage.getItem('matchstickTimeManager')));
```

---

## 测试完成检查

- [ ] 所有核心功能测试通过
- [ ] 数据保存和恢复正常
- [ ] 没有控制台错误
- [ ] 性能正常
- [ ] 已创建数据备份

**签名：________________  日期：________________**

