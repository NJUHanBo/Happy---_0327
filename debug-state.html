<!DOCTYPE html>
<html>
<head>
    <title>Stateè°ƒè¯•å·¥å…·</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1e1e1e; 
            color: #d4d4d4; 
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        pre {
            background: #2d2d30;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <h1>ğŸ” Stateè°ƒè¯•å·¥å…·</h1>
    
    <button onclick="checkState()">æ£€æŸ¥å½“å‰State</button>
    <button onclick="addTestTask()">æ·»åŠ æµ‹è¯•ä»»åŠ¡</button>
    <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
    <button onclick="location.href='/'">è¿”å›ä¸»åº”ç”¨</button>
    
    <div id="output"></div>
    
    <script src="scripts/core/storage.js"></script>
    <script src="scripts/core/state-manager.js"></script>
    <script src="scripts/core/task-manager.js"></script>
    <script src="scripts/main.js"></script>
    
    <script>
        function log(msg, isError = false) {
            const div = document.getElementById('output');
            const p = document.createElement('div');
            p.innerHTML = `<span class="${isError ? 'error' : 'success'}">${msg}</span>`;
            div.appendChild(p);
        }
        
        function checkState() {
            document.getElementById('output').innerHTML = '<h2>Stateæ£€æŸ¥ç»“æœ</h2>';
            
            try {
                log('âœ… window.state å­˜åœ¨: ' + (!!window.state));
                
                if (window.state) {
                    const dailyCount = (window.state.dailyTasks || []).length;
                    const projectCount = (window.state.projects || []).length;
                    const todoCount = (window.state.todos || []).length;
                    
                    log(`âœ… æ—¥å¸¸ä»»åŠ¡æ•°é‡: ${dailyCount}`);
                    log(`âœ… é¡¹ç›®æ•°é‡: ${projectCount}`);
                    log(`âœ… å¾…åŠæ•°é‡: ${todoCount}`);
                    
                    if (dailyCount > 0) {
                        log('<br>ğŸ“‹ æ—¥å¸¸ä»»åŠ¡åˆ—è¡¨:');
                        window.state.dailyTasks.forEach((task, i) => {
                            log(`  ${i + 1}. ${task.name} (ID: ${task.id})`);
                        });
                    }
                    
                    if (projectCount > 0) {
                        log('<br>ğŸ“‹ é¡¹ç›®åˆ—è¡¨:');
                        window.state.projects.forEach((proj, i) => {
                            log(`  ${i + 1}. ${proj.name} (ID: ${proj.id})`);
                        });
                    }
                    
                    if (todoCount > 0) {
                        log('<br>ğŸ“‹ å¾…åŠåˆ—è¡¨:');
                        window.state.todos.forEach((todo, i) => {
                            log(`  ${i + 1}. ${todo.name} (ID: ${todo.id})`);
                        });
                    }
                    
                    log('<br><pre>' + JSON.stringify(window.state, null, 2) + '</pre>');
                }
                
                const tm = getTaskManager();
                log('<br>âœ… TaskManager å¯ç”¨: ' + (!!tm));
                
                if (tm) {
                    const tmDaily = tm.getDailyTasks().length;
                    const tmProjects = tm.getProjects().length;
                    const tmTodos = tm.getTodos().length;
                    
                    log(`âœ… TaskManagerçœ‹åˆ°çš„æ—¥å¸¸ä»»åŠ¡: ${tmDaily}`);
                    log(`âœ… TaskManagerçœ‹åˆ°çš„é¡¹ç›®: ${tmProjects}`);
                    log(`âœ… TaskManagerçœ‹åˆ°çš„å¾…åŠ: ${tmTodos}`);
                }
                
            } catch (e) {
                log('âŒ é”™è¯¯: ' + e.message, true);
                console.error(e);
            }
        }
        
        function addTestTask() {
            try {
                const tm = getTaskManager();
                if (!tm) {
                    log('âŒ TaskManagerä¸å¯ç”¨', true);
                    return;
                }
                
                const testTask = tm.addDailyTask({
                    name: 'è°ƒè¯•æµ‹è¯•ä»»åŠ¡ ' + Date.now(),
                    dailyTime: 30,
                    importance: 3,
                    interest: 3
                });
                
                log('âœ… æµ‹è¯•ä»»åŠ¡å·²æ·»åŠ : ' + testTask.name);
                
                // ä¿å­˜
                if (typeof saveState === 'function') {
                    saveState();
                    log('âœ… Stateå·²ä¿å­˜');
                }
                
                // é‡æ–°æ£€æŸ¥
                setTimeout(checkState, 100);
                
            } catch (e) {
                log('âŒ æ·»åŠ å¤±è´¥: ' + e.message, true);
                console.error(e);
            }
        }
        
        // è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', () => {
            setTimeout(checkState, 500);
        });
    </script>
</body>
</html>

