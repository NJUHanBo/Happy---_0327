# 重构规则

## 第一原则：不破坏用户数据

所有重构必须保证用户的localStorage数据仍然可用。

## 当前规则

### 1. main.js冻结（2025-10-04起）
- ❌ 禁止在main.js添加新函数
- ❌ 禁止在main.js添加新的全局变量
- ✅ 允许修复bug
- ✅ 允许提取代码到新模块

### 2. 新功能必须模块化
- 所有新功能写在 `scripts/modules/` 下
- 每个模块不超过300行
- 必须有明确的导出接口

### 3. 删除前先备份
在删除任何代码前，确保有git提交记录

### 4. 数据迁移
- 所有state结构变更必须写迁移函数
- state必须包含version字段
- 测试迁移函数

## 重构进度追踪

- [ ] 阶段0: 停止挖坑
- [ ] 阶段1: 建立基础设施
- [ ] 阶段2: 提取核心模块
- [ ] 阶段3: 清理垃圾
- [ ] 阶段4: 隔离子系统

