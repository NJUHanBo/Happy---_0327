<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>TaskManageråŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .test { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .pass { background: #1e7e34; }
        .fail { background: #c82333; }
        h1 { color: #4ec9b0; }
        pre { background: #2d2d30; padding: 10px; border-radius: 4px; }
        button { 
            padding: 10px 20px; 
            margin: 10px 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            background: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª TaskManager åŠŸèƒ½æµ‹è¯•</h1>
    <p>æµ‹è¯•è¿ç§»çš„5ä¸ªå‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ...</p>
    
    <button onclick="runTests()">â–¶ï¸ è¿è¡Œæµ‹è¯•</button>
    <button onclick="location.reload()">ğŸ”„ é‡æ–°åŠ è½½</button>
    
    <div id="results"></div>
    
    <script src="scripts/core/storage.js"></script>
    <script src="scripts/core/state-manager.js"></script>
    <script src="scripts/core/task-manager.js"></script>
    
    <script>
        let testResults = [];
        
        function log(message, pass) {
            const div = document.createElement('div');
            div.className = `test ${pass ? 'pass' : 'fail'}`;
            div.textContent = `${pass ? 'âœ…' : 'âŒ'} ${message}`;
            document.getElementById('results').appendChild(div);
            testResults.push({ message, pass });
        }
        
        function runTests() {
            document.getElementById('results').innerHTML = '<h2>æµ‹è¯•ç»“æœ</h2>';
            testResults = [];
            
            try {
                // æµ‹è¯•1: æ¨¡å—åŠ è½½
                log('TaskManagerç±»å­˜åœ¨', typeof TaskManager !== 'undefined');
                log('getTaskManagerå‡½æ•°å­˜åœ¨', typeof getTaskManager === 'function');
                log('StateManagerç±»å­˜åœ¨', typeof StateManager !== 'undefined');
                log('StorageManagerå¯¹è±¡å­˜åœ¨', typeof StorageManager !== 'undefined');
                
                // æµ‹è¯•2: åˆ›å»ºå®ä¾‹
                const sm = new StateManager();
                log('StateManagerå®ä¾‹åˆ›å»ºæˆåŠŸ', sm !== null);
                
                const tm = new TaskManager(sm);
                log('TaskManagerå®ä¾‹åˆ›å»ºæˆåŠŸ', tm !== null);
                
                // æµ‹è¯•3: æ·»åŠ æ—¥å¸¸ä»»åŠ¡
                const dailyTask = tm.addDailyTask({
                    name: 'æµ‹è¯•ä»»åŠ¡',
                    dailyTime: 1,
                    importance: 3,
                    interest: 3
                });
                log('addDailyTaskæˆåŠŸ', dailyTask && dailyTask.name === 'æµ‹è¯•ä»»åŠ¡');
                
                // æµ‹è¯•4: è·å–ä»»åŠ¡
                const tasks = tm.getDailyTasks();
                log('getDailyTasksæˆåŠŸ', tasks.length > 0);
                log('ä»»åŠ¡æœ‰æ­£ç¡®çš„ID', tasks[0].id !== undefined);
                log('ä»»åŠ¡æœ‰æ­£ç¡®çš„åç§°', tasks[0].name === 'æµ‹è¯•ä»»åŠ¡');
                
                // æµ‹è¯•5: æ›´æ–°ä»»åŠ¡
                const updated = tm.updateDailyTask(tasks[0].id, { name: 'æ›´æ–°åçš„ä»»åŠ¡' });
                log('updateDailyTaskæˆåŠŸ', updated && updated.name === 'æ›´æ–°åçš„ä»»åŠ¡');
                
                // æµ‹è¯•6: åˆ é™¤ä»»åŠ¡
                const deleted = tm.deleteDailyTask(tasks[0].id);
                log('deleteDailyTaskæˆåŠŸ', deleted === true);
                log('ä»»åŠ¡å·²åˆ é™¤', tm.getDailyTasks().length === 0);
                
                // æµ‹è¯•7: æ·»åŠ é¡¹ç›®
                const project = tm.addProject({
                    name: 'æµ‹è¯•é¡¹ç›®',
                    deadline: '2025-12-31',
                    dailyTime: 2,
                    importance: 4,
                    interest: 4,
                    milestones: [
                        { name: 'é‡Œç¨‹ç¢‘1', date: '2025-11-01' }
                    ]
                });
                log('addProjectæˆåŠŸ', project && project.name === 'æµ‹è¯•é¡¹ç›®');
                
                // æµ‹è¯•8: åˆ é™¤é¡¹ç›®
                const projectDeleted = tm.deleteProject(project.id);
                log('deleteProjectæˆåŠŸ', projectDeleted === true);
                
                // æµ‹è¯•9: æ·»åŠ å¾…åŠ
                const todo = tm.addTodo({
                    name: 'æµ‹è¯•å¾…åŠ',
                    deadline: '2025-12-31',
                    estimatedTime: 1,
                    importance: 3,
                    urgency: 3
                });
                log('addTodoæˆåŠŸ', todo && todo.name === 'æµ‹è¯•å¾…åŠ');
                
                // æµ‹è¯•10: ç»Ÿè®¡åŠŸèƒ½
                const count = tm.getPendingTasksCount();
                log('getPendingTasksCountæˆåŠŸ', count.todo === 1);
                
                // æ¸…ç†
                tm.deleteTodo(todo.id);
                
                // æ€»ç»“
                const passed = testResults.filter(r => r.pass).length;
                const total = testResults.length;
                const percentage = Math.round((passed / total) * 100);
                
                const summary = document.createElement('div');
                summary.style.cssText = 'margin-top:20px;padding:15px;background:#2d2d30;border-radius:8px;';
                summary.innerHTML = `
                    <h2 style="color:${percentage === 100 ? '#28a745' : '#ffc107'}">
                        ${percentage === 100 ? 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼' : 'âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥'}
                    </h2>
                    <p>é€šè¿‡: ${passed}/${total} (${percentage}%)</p>
                    ${percentage === 100 ? `
                        <p style="color:#4ec9b0">âœ… TaskManagerå·¥ä½œæ­£å¸¸ï¼Œå¯ä»¥ç»§ç»­è¿ç§»ï¼</p>
                        <p>å·²æµ‹è¯•çš„å‡½æ•°ï¼š</p>
                        <ul>
                            <li>addDailyTask()</li>
                            <li>updateDailyTask()</li>
                            <li>deleteDailyTask()</li>
                            <li>addProject()</li>
                            <li>deleteProject()</li>
                            <li>addTodo()</li>
                            <li>deleteTodo()</li>
                            <li>getPendingTasksCount()</li>
                        </ul>
                    ` : `
                        <p style="color:#dc3545">âŒ è¯·æ£€æŸ¥å¤±è´¥çš„æµ‹è¯•</p>
                    `}
                `;
                document.getElementById('results').appendChild(summary);
                
            } catch (error) {
                log(`è‡´å‘½é”™è¯¯: ${error.message}`, false);
                console.error('Test error:', error);
            }
        }
        
        // è‡ªåŠ¨è¿è¡Œ
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>
</html>

